<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Foundation | My first accordion</title>
    <link rel="stylesheet" href="css/foundation.css" />
    <script src="js/modernizr.js"></script>
    <script type="text/javascript">
      var PAYMILL_PUBLIC_KEY = '264783270323a4a3374e4bdcdee9f8d2';
      var VALIDATE_CVC = true;
    </script>
  </head>
  <body>



    <div class="large-12 columns">
      <dl class="accordion" data-accordion>
        <dd>
          <a href="#panel1">Warenkorb</a>
          <div id="panel1" class="content">
            <dl class="tabs" data-tab>
              <dd class="active"><a href="#panel1-tab1">Tab 1</a></dd>
              <dd><a href="#panel1-tab2">Tab 2</a></dd>
              <dd><a href="#panel1-tab3">Tab 3</a></dd>
              <dd><a href="#panel1-tab4">Tab 4</a></dd>
            </dl>
            <form data-abide>
              <div class="tabs-content">
                <div class="content active" id="panel1-tab1">
                  <fieldset>
                    <legend>Fieldset</legend>
                    <div class="row">
                      <div class="large-12 columns">
                        <label for="password">Password <small>required</small></label>
                        <input type="password" id="password" placeholder="LittleW0men." name="password" required>
                        <small class="error">Passwords must be at least 8 characters with 1 capital letter, 1 number, and one special character.</small>
                      </div>
                      <div class="large-12 columns">
                        <label for="confirmPassword">Confirm Password <small>required</small></label>
                        <input type="password" id="confirmPassword" placeholder="LittleW0men." name="confirmPassword" required data-equalto="password">
                        <small class="error" data-error-message>Passwords must match.</small>
                      </div>
                    </div>
                    <div class="row">
                      <div class="large-12 columns">
                        <label for="phone">Phone</label>
                        <input type="tel" id="phone" placeholder="1 234-567-8910">
                        <small class="error">Please enter a properly formatted telephone number.</small>
                      </div>
                    </div>
                    <div class="row">
                      <div class="large-12 columns">
                        <button type="submit" class="medium button green">Submit</button>
                      </div>
                    </div>
                  </fieldset>
                </div>
                <div class="content" id="panel1-tab2">
                  <fieldset>
                    <legend>Fieldset</legend>
                    <div class="row">
                      <div class="large-4 columns">
                        <label for="email">Email</label>
                        <input type="email" id="email" placeholder="foundation@zurb.com">
                        <small class="error">Valid email required.</small>
                      </div>
                      <div class="large-4 columns">
                        <label for="url">URL <small>required</small></label>
                        <input type="url" id="url" placeholder="http://zurb.com" required>
                        <small class="error">Valid URL required.</small>
                      </div>
                      <div class="large-4 columns">
                        <div class="row collapse">
                          <label for="customDropdown1">Hardest to find in grocery <small>required</small></label>
                          <select id="customDropdown1" class="medium" required>
                            <option value="">Select grocery item</option>
                            <option value="first">Green Chilies</option>
                            <option value="second">Raisins</option>
                            <option value="third">Panko bread crumbs</option>
                            <option value="fourth">Assistance</option>
                          </select>
                          <small class="error">Broke.</small>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="large-12 columns">
                        <hr>
                      </div>
                    </div>
                    <div class="row">
                      <div class="large-6 columns">
                        <label for="radio1"><input name="radioButtons" type="radio" id="radio1" required> Radio Button 1</label>
                        <label for="radio2"><input name="radioButtons" type="radio" id="radio2" required> Radio Button 2</label>
                        <label for="radio3"><input name="radioButtons" type="radio" id="radio3" required> Radio Button 3</label>
                      </div>
                      <div class="large-6 columns">
                        <label for="checkbox1"><input type="checkbox" id="checkbox1" required> Label for Checkbox</label>
                        <label for="checkbox2"><input type="checkbox" id="checkbox2" CHECKED required> Label for Checkbox</label>
                        <label for="checkbox3"><input type="checkbox" CHECKED id="checkbox3" required> Label for Checkbox</label>
                      </div>
                    </div>
                    <div class="row">
                      <div class="large-12 columns">
                        <hr>
                      </div>
                    </div>
                    <div class="row">
                      <div class="large-12 columns">
                        <label for="remarks">Closing Remarks</label>
                        <textarea id="remarks" name="remarks" placeholder="Leave your remarks here."></textarea>
                      </div>
                    </div>
                    <div class="row">
                      <div class="large-12 columns">
                        <button type="submit" class="medium button green">Submit</button>
                      </div>
                    </div>
                  </fieldset>
                </div>
                <div class="content" id="panel1-tab3">
                  <p>Third tab content goes here...</p>
                </div>
                <div class="content" id="panel1-tab4">
                  <p>Fourth tab content goes here...</p>
                </div>
              </div>
            </form>
          </div>
        </dd>
        <dd>
          <a href="#panel2">Service und Versandkosten</a>
          <div id="panel2" class="content">
            Panel 2. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
          </div>
        </dd>
        <dd>
          <a href="#panel3">Zahlungsmethode</a>
          <div id="panel3" class="content active">
            <dl class="tabs" data-tab>
              <dd class="active"><a id="payment-cc" href="#panel3-tab1" class="paymenttype">Legacy credit card</a></dd>
              <dd><a id="payment-elv" href="#panel3-tab2" class="paymenttype">Direct debit</a></dd>
            </dl>
            <form id="payment-form" action="payment.php" method="POST">
              <div class="tabs-content">
                <div class="content active" id="panel3-tab1">
                  <fieldset>
                    <legend>Legacy credit card</legend>
                    <div class="row">
                      <div class="large-6 columns">                  
                        <label for="card-number">Card number</label>
                        <input id="card-number" class="card-number" type="text" placeholder="**** **** **** ****" maxlength="19">
                      </div>
                      <div class="large-6 columns">                  
                        <label for="card-expiry">Expires</label>
                        <input id="card-expiry" class="card-expiry" type="text" placeholder="MM/YY" maxlength="7">
                      </div>
                    </div>
                    <div class="row">
                      <div class="large-9 columns">                  
                        <label for="card-holdername">Card holder</label>
                        <input id="card-holdername" class="card-holdername" type="text">
                      </div>
                      <div class="large-3 columns">                  
                        <label for="card-cvc"><span class="card-cvc-label">CVC</span><span id="tooltip" title="">?</span></label>
                        <input id="card-cvc" class="card-cvc" type="text" placeholder="CVC" maxlength="4">
                      </div>
                    </div>
                  </fieldset>
                </div>
                <div class="content" id="panel3-tab2">
                  <fieldset>
                    <legend>Direct debit</legend>
                    <div class="row">
                      <div class="large-6 columns">                  
                        <label for="elv-iban">IBAN</label>
                        <input id="elv-iban" class="elv-iban" type="text">
                      </div>
                      <div class="large-6 columns">                  
                        <label for="elv-bic">BIC</label>
                        <input id="elv-bic" class="elv-bic" type="text">
                      </div>
                    </div>
                    <div class="row">
                      <div class="large-12 columns">                  
                        <label for="elv-holdername">Holdername</label>
                        <input id="elv-holdername" class="elv-holdername" type="text">
                      </div>
                    </div>
                  </fieldset>
                </div>
                <div class="large-5 columns">                  
                  <fieldset>
                    <legend>Amount</legend>
                    <div class="row">
                      <div class="large-6 columns">                  
                        <label for="amount">Amount</label>
                        <input id="amount" type="text" value="10.00" name="amount">
                      </div>
                      <div class="large-6 columns">                  
                        <label for="currency">Currency</label>
                        <input id="currency" type="text" value="EUR" name="currency">
                      </div>
                    </div>
                    <div class="row">
                      <div class="payment_errors">&nbsp;</div>
                      <div class="large-12 columns">                  
                        <button id="paymill-submit-button" class="submit-button" type="submit">Submit</button>
                      </div>
                    </div>
                  </fieldset>
                </div>
              </div>
            </form>
          </div>
        </dd>
        <dd>
          <a href="#panel4">Ihre Bestellung</a>
          <div id="panel4" class="content">
            Panel 4. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
          </div>
        </dd>
        <dd>
          <a href="#panel5">Ihre Daten, Widerrufsbelehrung</a>
          <div id="panel5" class="content">
            Panel 5. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
          </div>
        </dd>
      </dl>
    </div>

    <script src="js/jquery.js"></script>
    <script type="text/javascript" src="https://bridge.paymill.de/"></script>
    <!--<script src="js/foundation.min.js"></script> -->
    <script src="js/foundation/foundation.js"></script>
    <script src="js/foundation/foundation.abide.js"></script>
    <script src="js/foundation/foundation.accordion.js"></script>
    <script src="js/foundation/foundation.tab.js"></script>
    <script>
      $(document).foundation();
    </script>
    <script type="text/javascript">
      $.noConflict();

      jQuery(document).ready(function ($) {
        var doc = document;
        var body = $( doc.body );

        $('.card-number').keyup(function() {
          var brand = paymill.cardType($('.card-number').val());
          brand = brand.toLowerCase();
          $(".card-number")[0].className = $(".card-number")[0].className.replace(/paymill-card-number-.*/g, '');
          if (brand !== 'unknown') {
            $('#card-number').addClass("paymill-card-number-" + brand);
          }

          if (brand !== 'maestro') {
            VALIDATE_CVC = true;
          } else {
            VALIDATE_CVC = false;
          }
        });

        $('.card-expiry').keyup(function() {
          if ( /^\d\d$/.test( $('.card-expiry').val() ) ) {
            text = $('.card-expiry').val();
            $('.card-expiry').val(text += "/");
          }
        });


        function PaymillResponseHandler(error, result) {
          if (error) {
            // Zeigt den Fehler überhalb des Formulars an
            $(".payment_errors").text(error.apierror);
            $(".payment_errors").css("display","inline");
          } else {
            $(".payment_errors").css("display","none");
            $(".payment_errors").text("");
            var form = $("#payment-form");
            // Token
            var token = result.token;
            // Token in das Formular einfügen damit es an den Server übergeben wird
            form.append("<input type='hidden' name='paymillToken' value='" + token + "'/>");
            form.get(0).submit();
          }
          $(".submit-button").removeAttr("disabled");
        }

        $("#payment-form").submit(function (event) {
          // Absenden Button deaktivieren um weitere Klicks zu vermeiden
          $('.submit-button').attr("disabled", "disabled");

          paymenttype = $('.paymenttype_active').length ? $('.paymenttype_active').attr( 'id' ) : 'payment-cc';
          switch (paymenttype) {
            case "payment-cc":
              $('.submit-button').attr("disabled", "disabled");
              if (false == paymill.validateHolder($('.card-holdername').val())) {
                $(".payment_errors").text("invalid-card-holdername");
                $(".payment_errors").css("display","inline");
                $(".submit-button").removeAttr("disabled");
                return false;
              }
              if (false == paymill.validateCvc($('.card-cvc').val())) {
                if(VALIDATE_CVC){
                  $(".payment_errors").text("invalid-card-cvc");
                  $(".payment_errors").css("display","inline");
                  $(".submit-button").removeAttr("disabled");
                  return false;
                } else {
                  $('.card-cvc').val("000");
                }
              }
              if (false == paymill.validateCardNumber($('.card-number').val())) {
                $(".payment_errors").text("invalid-card-number");
                $(".payment_errors").css("display","inline");
                $(".submit-button").removeAttr("disabled");
                return false;
              }
              var expiry = $('.card-expiry').val();
              expiry = expiry.split("/");
              if(expiry[1] && (expiry[1].length <= 2)){
                expiry[1] = '20'+expiry[1];
              }
              if (false == paymill.validateExpiry(expiry[0], expiry[1])) {
                $(".payment_errors").text("invalid-card-expiry-date");
                $(".payment_errors").css("display","inline");
                $(".submit-button").removeAttr("disabled");
                return false;
              }
              alert( "DEV: Formular darf an dieser Stelle noch nicht gesendet werden. Daten müssen in Caddy-Session übernommen werden.");
              return false;
              var params = {
                amount_int:     $('.amount').val() * 100,  // E.g. "15" for 0.15 Eur
                currency:       $('.currency').val(),    // ISO 4217 e.g. "EUR"
                number:         $('.card-number').val(),
                exp_month:      expiry[0],
                exp_year:       expiry[1],
                cvc:            $('.card-cvc').val(),
                cardholder:     $('.card-holdername').val()
              };
              break;

            case "payment-elv":
              $('.submit-button').attr("disabled", "disabled");
              if (false == $('.elv-holdername').val()) {
                $(".payment_errors").text("invalid-elv-holdername");
                $(".payment_errors").css("display","inline");
                $(".submit-button").removeAttr("disabled");
                return false;
              }
              if (false == paymill.validateAccountNumber($('.elv-account').val())) {
                $(".payment_errors").text("invalid-elv-accountnumber");
                $(".payment_errors").css("display","inline");
                $(".submit-button").removeAttr("disabled");
                return false;
              }
              if (false == paymill.validateBankCode($('.elv-bankcode').val())) {
                $(".payment_errors").text("invalid-elv-bankcode");
                $(".payment_errors").css("display","inline");
                $(".submit-button").removeAttr("disabled");
                return false;
              }
              alert( "DEV: Formular darf an dieser Stelle noch nicht gesendet werden. Daten müssen in Caddy-Session übernommen werden.");
              return false;
              var params = {
                number:         $('.elv-account').val(),
                bank:           $('.elv-bankcode').val(),
                accountholder:  $('.elv-holdername').val()
              };
              break;
          }

          paymill.createToken(params, PaymillResponseHandler);
          return false;
        });
        // Toggle buttons and forms
        $(".paymenttype").click(function (event) {
          if ($(this).hasClass('paymenttype_active')){
            return false;
          }
          $(".payment_errors").css("display","none");
          if ($(this).attr( 'id' ) == 'payment-cc') {
            $('#payment-elv').removeClass('paymenttype_active');
            $('#payment-cc').addClass('paymenttype_active');
          } else {
            $('#payment-cc').removeClass('paymenttype_active');
            $('#payment-elv').addClass('paymenttype_active');
          }
        });
      });
    </script>
  </body>
</html>
